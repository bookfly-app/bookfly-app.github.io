import"./Bg9kRutz.js";import{p as Ct,v as i,g as t,f as Bt,s as p,c as j,r as tt,t as yt,a as Lt,ab as g,k as S}from"./C62SPajG.js";import{d as Et}from"./Bu0Zqk6q.js";import{a as $t,t as Ht}from"./Bqi7JOxH.js";import{r as It,a as Xt}from"./BqKKz4p4.js";import{s as o,u as mt}from"./D9igWbRp.js";import{a as kt}from"./Bhk5afer.js";import{p as r}from"./B65nbPqP.js";import{p as D,b as R,r as Yt}from"./BbJ7nyNa.js";import{o as At}from"./Dxq3VFhd.js";async function Ft(q,v,B,h,H,X){if(!t(v))return;const c=await B();h(await mt(c)),H()(h()),X()}function Dt(q,v){v()}var Tt=Ht('<input> <div class="preview svelte-ndm28l"><div class="image svelte-ndm28l"><img alt="User content" draggable="false" class="svelte-ndm28l"> <div class="overlay left svelte-ndm28l"></div> <div class="overlay right svelte-ndm28l"></div> <div class="overlay top svelte-ndm28l"></div> <div class="overlay bottom svelte-ndm28l"></div> <div class="cropper svelte-ndm28l"><div class="top left handle svelte-ndm28l"></div> <div class="top right handle svelte-ndm28l"></div> <div class="bottom left handle svelte-ndm28l"></div> <div class="bottom right handle svelte-ndm28l"></div></div></div> <button class="upload svelte-ndm28l">Done</button> <button class="choose-again svelte-ndm28l">Choose a different image</button> <button class="cancel svelte-ndm28l">Cancel</button></div>',1);function Ot(q,v){Ct(v,!0);let B=g(null),h,H,X,c=D(v,"aspectRatio",3,void 0),et=D(v,"onupload",3,e=>{}),z=D(v,"imageId",15,null);D(v,"circular",3,!1);let gt=D(v,"allowEdit",3,!0),ht=Yt(v,["$$slots","$$events","$$legacy","aspectRatio","onupload","imageId","circular","allowEdit"]),_=g(1);function G(){i(B,null),i(f,null),H.style.display="none"}function ut(){X.click()}let f=g(null);async function pt(){var s,l;if(!gt()){const a=((s=t(B))==null?void 0:s[0])??null;if(!a)return;z(await mt(a)),et()(z()),G()}if(i(f,r(((l=t(B))==null?void 0:l[0])??null)),!t(f))return;const e=new FileReader;e.onloadend=function(){H.style.display="flex",h.src=e.result;const a=h.naturalWidth/h.naturalHeight;a>1?(i(y,r(t(n).getBoundingClientRect().width)),i(L,t(y)*(1/a)),i(Y,(t(n).getBoundingClientRect().height-t(L))/2),i(_,t(n).getBoundingClientRect().height/t(L))):(i(L,r(t(n).getBoundingClientRect().height)),i(y,t(L)*a),i(k,(t(n).getBoundingClientRect().width-t(y))/2),i(_,t(n).getBoundingClientRect().width/t(y))),c()&&(c()<1?(i(m,(t(n).getBoundingClientRect().width-t(n).getBoundingClientRect().height*c())/2),i(x,r(t(m)))):(i(d,(t(n).getBoundingClientRect().height-t(n).getBoundingClientRect().width/c())/2),i(b,r(t(d)))))},t(f)?e.readAsDataURL(t(f)):h.src=""}function vt(){return t(u)/t(E)}function ft(){return new Promise((e,s)=>{const l=new Image;l.onload=()=>{const C=document.createElement("canvas");C.width=h.getBoundingClientRect().width,C.height=C.width*(1/vt());const xt=C.getContext("2d"),P=h.naturalWidth/C.width;xt.drawImage(l,P*(t(m)-t(k)),P*(t(d)-t(Y)),P*t(u),P*t(E),0,0,C.width,C.height),C.toBlob(ct=>{if(!ct)return s(new Error("Canvas is empty"));const Mt=new File([ct],t(f).name,{type:t(f).type});e(Mt)},t(f).type)},l.onerror=s;const a=new FileReader;a.onload=function(){l.src=a.result},a.onerror=s,a.readAsDataURL(t(f))})}let T,I=g(!1),w=g(null),k=g(0),Y=g(0),y=g(0),L=g(0),J,K,N,O,n=g(null),d=g(0),m=g(0),b=g(0),x=g(0),wt=1,u=S(()=>(t(d),t(b),t(n)?t(n).getBoundingClientRect().width-t(m)-t(x):0)),E=S(()=>(t(d),t(b),t(n)?t(n).getBoundingClientRect().height-t(d)-t(b):0));At(()=>{T.addEventListener("wheel",e=>{i(_,r(Math.min(Math.max(wt,t(_)-e.deltaY/5),10)))},!0),h.addEventListener("mousedown",()=>{i(I,!0)}),T.addEventListener("mousedown",()=>{i(I,!0)}),J.addEventListener("mousedown",()=>{i(w,"top left")}),K.addEventListener("mousedown",()=>{i(w,"top right")}),N.addEventListener("mousedown",()=>{i(w,"bottom left")}),O.addEventListener("mousedown",()=>{i(w,"bottom right")}),document.addEventListener("mousemove",e=>{if(t(w)=="top left"){const s=Math.min(e.movementX,e.movementY);if(i(m,r(Math.max(0,t(m)+s))),c()){const l=t(u)*(1/c()),a=Math.abs(t(n).getBoundingClientRect().height-l-t(b));i(d,r(a))}}else if(t(w)=="top right"){const s=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(x,r(Math.max(0,t(x)-s*Math.sign(e.movementX)))),c()){const l=t(u)*(1/c()),a=Math.abs(t(n).getBoundingClientRect().height-l-t(b));i(d,r(a))}}else if(t(w)=="bottom left"){const s=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(m,r(Math.max(0,t(m)+s*Math.sign(e.movementX)))),c()){const l=t(u)*(1/c()),a=Math.abs(t(n).getBoundingClientRect().height-l-t(d));i(b,r(a))}}else if(t(w)=="bottom right"){const s=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(x,r(Math.max(0,t(x)-s*Math.sign(e.movementX)))),c()){const l=t(u)*(1/c()),a=Math.abs(t(n).getBoundingClientRect().height-l-t(d));i(b,r(a))}}else if(t(I)){let s=t(k)+e.movementX,l=t(Y)+e.movementY;i(k,r(Math.max(Math.min(t(m),s),t(m)+t(u)-t(y)*t(_)))),i(Y,r(Math.max(Math.min(t(d),l),t(d)+t(E)-t(L)*t(_))))}},!0),document.addEventListener("mouseup",()=>{i(I,!1),i(w,null)})});const it=S(()=>(t(m),t(d),t(n)?t(n).getBoundingClientRect().height:0)),bt=S(()=>t(n)?t(d)+t(E):0);var nt=Tt(),A=Bt(nt);It(A);let at;R(A,e=>X=e,()=>X);var Q=p(A,2),W=j(Q),$=j(W);R($,e=>h=e,()=>h);var V=p($,2),Z=p(V,2),U=p(Z,2),F=p(U,2),M=p(F,2),ot=j(M);R(ot,e=>J=e,()=>J);var lt=p(ot,2);R(lt,e=>K=e,()=>K);var st=p(lt,2);R(st,e=>N=e,()=>N);var Rt=p(st,2);R(Rt,e=>O=e,()=>O),tt(M),R(M,e=>T=e,()=>T),tt(W),R(W,e=>i(n,e),()=>t(n));var dt=p(W,2);dt.__click=[Ft,f,ft,z,et,G];var rt=p(dt,2);rt.__click=ut;var _t=p(rt,2);_t.__click=[Dt,G],tt(Q),R(Q,e=>H=e,()=>H),yt((e,s,l,a)=>{at=Xt(A,at,{...ht,onchange:pt,type:"file"},"svelte-ndm28l"),o($,"cursor",t(I)?"grabbing":"grab"),o($,"left",`${t(k)??""}px`),o($,"top",`${t(Y)??""}px`),o($,"width",`${t(y)*t(_)}px`),o($,"height",`${t(L)*t(_)}px`),o(V,"width",`${e??""}px`),o(V,"height",`${t(it)??""}px`),o(Z,"width",`${s??""}px`),o(Z,"height",`${t(it)??""}px`),o(U,"left",`${t(m)??""}px`),o(U,"width",`${t(u)??""}px`),o(U,"height",`${l??""}px`),o(F,"right",`${t(x)??""}px`),o(F,"width",`${t(u)??""}px`),o(F,"height",`${a??""}px`),o(F,"top",`${t(bt)??""}px`),o(M,"width",`${t(u)??""}px`),o(M,"height",`${t(E)??""}px`),o(M,"top",`${t(d)??""}px`),o(M,"left",`${t(m)??""}px`),o(M,"cursor",t(I)?"grabbing":"grab")},[()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().width)??0)-t(u)-t(x)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().width)??0)-t(u)-t(m)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().height)??0)-t(E)-t(b)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().height)??0)-t(E)-t(d)}]),kt(A,()=>t(B),e=>i(B,e)),$t(q,nt),Lt()}Et(["click"]);export{Ot as I};
