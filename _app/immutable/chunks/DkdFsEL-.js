import"./Bg9kRutz.js";import{p as Ct,w as i,y as t,f as Bt,s as p,c as Z,r as tt,t as Lt,a as zt,a7 as h,a8 as U}from"./BaZyK-JQ.js";import{d as $t}from"./BuFl6vNe.js";import{a as jt,t as Et}from"./Dd2BwSaU.js";import{r as Ht,a as It}from"./D230ZY73.js";import{s as Xt}from"./B3s4N60E.js";import{s as o,u as gt}from"./C1NDFgNq.js";import{a as kt}from"./2_PfXxFa.js";import{p as d}from"./COAggT6D.js";import{p as A,b as R,r as Yt}from"./DBYv9uc3.js";import{o as At}from"./cM7fshyi.js";async function Ft(P,v,C,m,j,H){if(!t(v))return;const c=await C();m(await gt(c)),j()(m()),H()}function Dt(P,v){v()}var Tt=Et('<input> <div class="preview svelte-10j4zly"><div class="image svelte-10j4zly"><img alt="User content" draggable="false" class="svelte-10j4zly"> <div class="overlay left svelte-10j4zly"></div> <div class="overlay right svelte-10j4zly"></div> <div class="overlay top svelte-10j4zly"></div> <div class="overlay bottom svelte-10j4zly"></div> <div><div class="top left handle svelte-10j4zly"></div> <div class="top right handle svelte-10j4zly"></div> <div class="bottom left handle svelte-10j4zly"></div> <div class="bottom right handle svelte-10j4zly"></div></div></div> <button class="upload svelte-10j4zly">Done</button> <button class="choose-again svelte-10j4zly">Choose a different image</button> <button class="cancel svelte-10j4zly">Cancel</button></div>',1);function Vt(P,v){Ct(v,!0);let C=h(null),m,j,H,c=A(v,"aspectRatio",3,void 0),et=A(v,"onupload",3,e=>{}),S=A(v,"imageId",15,null),ht=A(v,"circular",3,!1),mt=A(v,"allowEdit",3,!0),ut=Yt(v,["$$slots","$$events","$$legacy","aspectRatio","onupload","imageId","circular","allowEdit"]),_=h(1);function q(){i(C,null),i(f,null),j.style.display="none"}function pt(){H.click()}let f=h(null);async function vt(){var s,l;if(!mt()){const a=((s=t(C))==null?void 0:s[0])??null;if(!a)return;S(await gt(a)),et()(S()),q()}if(i(f,d(((l=t(C))==null?void 0:l[0])??null)),!t(f))return;const e=new FileReader;e.onloadend=function(){j.style.display="flex",m.src=e.result;const a=m.naturalWidth/m.naturalHeight;a>1?(i(B,d(t(n).getBoundingClientRect().width)),i(L,t(B)*(1/a)),i(X,(t(n).getBoundingClientRect().height-t(L))/2),i(_,t(n).getBoundingClientRect().height/t(L))):(i(L,d(t(n).getBoundingClientRect().height)),i(B,t(L)*a),i(I,(t(n).getBoundingClientRect().width-t(B))/2),i(_,t(n).getBoundingClientRect().width/t(B))),c()&&(c()<1?(i(g,(t(n).getBoundingClientRect().width-t(n).getBoundingClientRect().height*c())/2),i(x,d(t(g)))):(i(r,(t(n).getBoundingClientRect().height-t(n).getBoundingClientRect().width/c())/2),i(b,d(t(r)))))},t(f)?e.readAsDataURL(t(f)):m.src=""}function ft(){return t(u)/t(z)}function wt(){return new Promise((e,s)=>{const l=new Image;l.onload=()=>{const M=document.createElement("canvas");M.width=m.getBoundingClientRect().width,M.height=M.width*(1/ft());const xt=M.getContext("2d"),W=m.naturalWidth/M.width;xt.drawImage(l,W*(t(g)-t(I)),W*(t(r)-t(X)),W*t(u),W*t(z),0,0,M.width,M.height),M.toBlob(ct=>{if(!ct)return s(new Error("Canvas is empty"));const Mt=new File([ct],t(f).name,{type:t(f).type});e(Mt)},t(f).type)},l.onerror=s;const a=new FileReader;a.onload=function(){l.src=a.result},a.onerror=s,a.readAsDataURL(t(f))})}let F,E=h(!1),w=h(null),I=h(0),X=h(0),B=h(0),L=h(0),G,J,K,N,n=h(null),r=h(0),g=h(0),b=h(0),x=h(0),bt=1,u=U(()=>(t(r),t(b),t(n)?t(n).getBoundingClientRect().width-t(g)-t(x):0)),z=U(()=>(t(r),t(b),t(n)?t(n).getBoundingClientRect().height-t(r)-t(b):0));At(()=>{F.addEventListener("wheel",e=>{i(_,d(Math.min(Math.max(bt,t(_)-e.deltaY/5),10)))},!0),m.addEventListener("mousedown",()=>{i(E,!0)}),F.addEventListener("mousedown",()=>{i(E,!0)}),G.addEventListener("mousedown",()=>{i(w,"top left")}),J.addEventListener("mousedown",()=>{i(w,"top right")}),K.addEventListener("mousedown",()=>{i(w,"bottom left")}),N.addEventListener("mousedown",()=>{i(w,"bottom right")}),document.addEventListener("mousemove",e=>{if(t(w)=="top left"){const s=Math.min(e.movementX,e.movementY);if(i(g,d(Math.max(0,t(g)+s))),c()){const l=t(u)*(1/c()),a=Math.abs(t(n).getBoundingClientRect().height-l-t(b));i(r,d(a))}}else if(t(w)=="top right"){const s=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(x,d(Math.max(0,t(x)-s*Math.sign(e.movementX)))),c()){const l=t(u)*(1/c()),a=Math.abs(t(n).getBoundingClientRect().height-l-t(b));i(r,d(a))}}else if(t(w)=="bottom left"){const s=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(g,d(Math.max(0,t(g)+s*Math.sign(e.movementX)))),c()){const l=t(u)*(1/c()),a=Math.abs(t(n).getBoundingClientRect().height-l-t(r));i(b,d(a))}}else if(t(w)=="bottom right"){const s=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(x,d(Math.max(0,t(x)-s*Math.sign(e.movementX)))),c()){const l=t(u)*(1/c()),a=Math.abs(t(n).getBoundingClientRect().height-l-t(r));i(b,d(a))}}else if(t(E)){let s=t(I)+e.movementX,l=t(X)+e.movementY;i(I,d(Math.max(Math.min(t(g),s),t(g)+t(u)-t(B)*t(_)))),i(X,d(Math.max(Math.min(t(r),l),t(r)+t(z)-t(L)*t(_))))}},!0),document.addEventListener("mouseup",()=>{i(E,!1),i(w,null)})});const it=U(()=>(t(g),t(r),t(n)?t(n).getBoundingClientRect().height:0)),yt=U(()=>t(n)?t(r)+t(z):0);var nt=Tt(),k=Bt(nt);Ht(k);let at;R(k,e=>H=e,()=>H);var O=p(k,2),D=Z(O),$=Z(D);R($,e=>m=e,()=>m);var Q=p($,2),V=p(Q,2),T=p(V,2),Y=p(T,2),y=p(Y,2),ot=Z(y);R(ot,e=>G=e,()=>G);var lt=p(ot,2);R(lt,e=>J=e,()=>J);var st=p(lt,2);R(st,e=>K=e,()=>K);var Rt=p(st,2);R(Rt,e=>N=e,()=>N),tt(y),R(y,e=>F=e,()=>F),tt(D),R(D,e=>i(n,e),()=>t(n));var rt=p(D,2);rt.__click=[Ft,f,wt,S,et,q];var dt=p(rt,2);dt.__click=pt;var _t=p(dt,2);_t.__click=[Dt,q],tt(O),R(O,e=>j=e,()=>j),Lt((e,s,l,a)=>{at=It(k,at,{...ut,onchange:vt,type:"file"},"svelte-10j4zly"),o($,"cursor",t(E)?"grabbing":"grab"),o($,"left",`${t(I)??""}px`),o($,"top",`${t(X)??""}px`),o($,"width",`${t(B)*t(_)}px`),o($,"height",`${t(L)*t(_)}px`),o(Q,"width",`${e??""}px`),o(Q,"height",`${t(it)??""}px`),o(V,"width",`${s??""}px`),o(V,"height",`${t(it)??""}px`),o(T,"left",`${t(g)??""}px`),o(T,"width",`${t(u)??""}px`),o(T,"height",`${l??""}px`),o(Y,"right",`${t(x)??""}px`),o(Y,"width",`${t(u)??""}px`),o(Y,"height",`${a??""}px`),o(Y,"top",`${t(yt)??""}px`),Xt(y,`cropper ${(ht()?"circular":"")??""} svelte-10j4zly`),o(y,"width",`${t(u)??""}px`),o(y,"height",`${t(z)??""}px`),o(y,"top",`${t(r)??""}px`),o(y,"left",`${t(g)??""}px`),o(y,"cursor",t(E)?"grabbing":"grab")},[()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().width)??0)-t(u)-t(x)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().width)??0)-t(u)-t(g)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().height)??0)-t(z)-t(b)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().height)??0)-t(z)-t(r)}]),kt(k,()=>t(C),e=>i(C,e)),jt(P,nt),zt()}$t(["click"]);export{Vt as I};
