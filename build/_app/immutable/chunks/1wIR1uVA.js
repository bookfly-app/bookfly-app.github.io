import{a as _t,t as xt}from"./gFbpwaTI.js";import{p as Mt,ab as i,g as t,f as Ct,s as u,j as Q,r as V,t as Bt,a as yt,aa as c,d as P}from"./DBPlaF8E.js";import{d as Lt}from"./CThlKSBW.js";import{r as $t,s as Ht}from"./CitSOB86.js";import{s as a,j as Et}from"./BgaTf3pO.js";import{a as It}from"./DW4Ndp52.js";import{p as S,a as d,r as Xt}from"./BW7aK-Zr.js";import{b as R}from"./CVPpxQ3u.js";import{o as kt}from"./CBxwvAny.js";async function Yt(j,v,$,h,H,X){if(!t(v))return;const r=await $();h(await Et(r)),H()(h()),X()}function Ft(j,v){v()}var At=xt('<input> <div class="preview svelte-ndm28l"><div class="image svelte-ndm28l"><img alt="User content" draggable="false" class="svelte-ndm28l"> <div class="overlay left svelte-ndm28l"></div> <div class="overlay right svelte-ndm28l"></div> <div class="overlay top svelte-ndm28l"></div> <div class="overlay bottom svelte-ndm28l"></div> <div class="cropper svelte-ndm28l"><div class="top left handle svelte-ndm28l"></div> <div class="top right handle svelte-ndm28l"></div> <div class="bottom left handle svelte-ndm28l"></div> <div class="bottom right handle svelte-ndm28l"></div></div></div> <button class="upload svelte-ndm28l">Done</button> <button class="choose-again svelte-ndm28l">Choose a different image</button> <button class="cancel svelte-ndm28l">Cancel</button></div>',1);function Gt(j,v){Mt(v,!0);let $=c(null),h,H,X,r=S(v,"aspectRatio",3,void 0),rt=S(v,"onupload",3,e=>{}),mt=S(v,"imageId",15,null);S(v,"circular",3,!1);let gt=Xt(v,["$$slots","$$events","$$legacy","aspectRatio","onupload","imageId","circular"]),_=c(1);function Z(){i($,null),i(f,null),H.style.display="none"}function ct(){X.click()}let f=c(null);function ht(){var l;if(i(f,d(((l=t($))==null?void 0:l[0])??null)),!t(f))return;const e=new FileReader;e.onloadend=function(){H.style.display="flex",h.src=e.result;const o=h.naturalWidth/h.naturalHeight;o>1?(i(B,d(t(n).getBoundingClientRect().width)),i(y,t(B)*(1/o)),i(Y,(t(n).getBoundingClientRect().height-t(y))/2),i(_,t(n).getBoundingClientRect().height/t(y))):(i(y,d(t(n).getBoundingClientRect().height)),i(B,t(y)*o),i(k,(t(n).getBoundingClientRect().width-t(B))/2),i(_,t(n).getBoundingClientRect().width/t(B))),r()&&(r()<1?(i(m,(t(n).getBoundingClientRect().width-t(n).getBoundingClientRect().height*r())/2),i(x,d(t(m)))):(i(s,(t(n).getBoundingClientRect().height-t(n).getBoundingClientRect().width/r())/2),i(w,d(t(s)))))},t(f)?e.readAsDataURL(t(f)):h.src=""}function ut(){return new Promise((e,l)=>{const o=new Image;o.onload=()=>{const C=document.createElement("canvas");C.width=h.getBoundingClientRect().width,C.height=C.width*(1/r());const wt=C.getContext("2d"),U=h.naturalWidth/C.width;wt.drawImage(o,U*(t(m)-t(k)),U*(t(s)-t(Y)),U*t(p),U*t(I),0,0,C.width,C.height),C.toBlob(dt=>{if(!dt)return l(new Error("Canvas is empty"));const Rt=new File([dt],t(f).name,{type:t(f).type});e(Rt)},t(f).type)},o.onerror=l;const g=new FileReader;g.onload=function(){o.src=g.result},g.onerror=l,g.readAsDataURL(t(f))})}let D,E=c(!1),b=c(null),k=c(0),Y=c(0),B=c(0),y=c(0),q,z,G,J,n=c(null),s=c(0),m=c(0),w=c(0),x=c(0),pt=1,p=P(()=>(t(s),t(w),t(n)?t(n).getBoundingClientRect().width-t(m)-t(x):0)),I=P(()=>(t(s),t(w),t(n)?t(n).getBoundingClientRect().height-t(s)-t(w):0));kt(()=>{D.addEventListener("wheel",e=>{i(_,d(Math.min(Math.max(pt,t(_)-e.deltaY/5),10)))},!0),h.addEventListener("mousedown",()=>{i(E,!0)}),D.addEventListener("mousedown",()=>{i(E,!0)}),q.addEventListener("mousedown",()=>{i(b,"top left")}),z.addEventListener("mousedown",()=>{i(b,"top right")}),G.addEventListener("mousedown",()=>{i(b,"bottom left")}),J.addEventListener("mousedown",()=>{i(b,"bottom right")}),document.addEventListener("mousemove",e=>{if(t(b)=="top left"){const l=Math.min(e.movementX,e.movementY);if(i(m,d(Math.max(0,t(m)+l))),r()){const o=t(p)*(1/r()),g=Math.abs(t(n).getBoundingClientRect().height-o-t(w));i(s,d(g))}}else if(t(b)=="top right"){const l=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(x,d(Math.max(0,t(x)-l*Math.sign(e.movementX)))),r()){const o=t(p)*(1/r()),g=Math.abs(t(n).getBoundingClientRect().height-o-t(w));i(s,d(g))}}else if(t(b)=="bottom left"){const l=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(m,d(Math.max(0,t(m)+l*Math.sign(e.movementX)))),r()){const o=t(p)*(1/r()),g=Math.abs(t(n).getBoundingClientRect().height-o-t(s));i(w,d(g))}}else if(t(b)=="bottom right"){const l=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(x,d(Math.max(0,t(x)-l*Math.sign(e.movementX)))),r()){const o=t(p)*(1/r()),g=Math.abs(t(n).getBoundingClientRect().height-o-t(s));i(w,d(g))}}else if(t(E)){let l=t(k)+e.movementX,o=t(Y)+e.movementY;i(k,d(Math.max(Math.min(t(m),l),t(m)+t(p)-t(B)*t(_)))),i(Y,d(Math.max(Math.min(t(s),o),t(s)+t(I)-t(y)*t(_))))}},!0),document.addEventListener("mouseup",()=>{i(E,!1),i(b,null)})});const tt=P(()=>(t(m),t(s),t(n)?t(n).getBoundingClientRect().height:0)),vt=P(()=>t(n)?t(s)+t(I):0);var et=At(),F=Ct(et);$t(F);let it;R(F,e=>X=e,()=>X);var K=u(F,2),T=Q(K),L=Q(T);R(L,e=>h=e,()=>h);var N=u(L,2),O=u(N,2),W=u(O,2),A=u(W,2),M=u(A,2),nt=Q(M);R(nt,e=>q=e,()=>q);var at=u(nt,2);R(at,e=>z=e,()=>z);var ot=u(at,2);R(ot,e=>G=e,()=>G);var ft=u(ot,2);R(ft,e=>J=e,()=>J),V(M),R(M,e=>D=e,()=>D),V(T),R(T,e=>i(n,e),()=>t(n));var lt=u(T,2);lt.__click=[Yt,f,ut,mt,rt,Z];var st=u(lt,2);st.__click=ct;var bt=u(st,2);bt.__click=[Ft,Z],V(K),R(K,e=>H=e,()=>H),Bt((e,l,o,g)=>{it=Ht(F,it,{...gt,onchange:ht,type:"file"},"svelte-ndm28l"),a(L,"cursor",t(E)?"grabbing":"grab"),a(L,"left",`${t(k)??""}px`),a(L,"top",`${t(Y)??""}px`),a(L,"width",`${t(B)*t(_)}px`),a(L,"height",`${t(y)*t(_)}px`),a(N,"width",`${e??""}px`),a(N,"height",`${t(tt)??""}px`),a(O,"width",`${l??""}px`),a(O,"height",`${t(tt)??""}px`),a(W,"left",`${t(m)??""}px`),a(W,"width",`${t(p)??""}px`),a(W,"height",`${o??""}px`),a(A,"right",`${t(x)??""}px`),a(A,"width",`${t(p)??""}px`),a(A,"height",`${g??""}px`),a(A,"top",`${t(vt)??""}px`),a(M,"width",`${t(p)??""}px`),a(M,"height",`${t(I)??""}px`),a(M,"top",`${t(s)??""}px`),a(M,"left",`${t(m)??""}px`),a(M,"cursor",t(E)?"grabbing":"grab")},[()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().width)??0)-t(p)-t(x)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().width)??0)-t(p)-t(m)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().height)??0)-t(I)-t(w)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().height)??0)-t(I)-t(s)}]),It(F,()=>t($),e=>i($,e)),_t(j,et),yt()}Lt(["click"]);export{Gt as I};
