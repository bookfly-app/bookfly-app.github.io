import"./Bg9kRutz.js";import{p as xt,a5 as i,i as t,f as Mt,s as p,c as V,r as Z,t as Ct,a as Bt,ab as g,k as P}from"./i-Dxzh4-.js";import{d as yt}from"./_7rhGYst.js";import{a as Lt,t as $t}from"./CjOfaZex.js";import{r as Ht,a as Et}from"./BrRXOXDQ.js";import{s as a}from"./C3MWGuYO.js";import{a as kt}from"./ONGQm3i5.js";import{p as d}from"./CHAJi5Dc.js";import{p as S,b as R,r as It}from"./C2UmEeKx.js";import{o as Xt}from"./Dxhw3p0l.js";import{k as Yt}from"./CCkeDGYs.js";async function At(q,v,H,h,E,I){if(!t(v))return;const r=await H();h(await Yt(r)),E()(h()),I()}function Ft(q,v){v()}var Dt=$t('<input> <div class="preview svelte-ndm28l"><div class="image svelte-ndm28l"><img alt="User content" draggable="false" class="svelte-ndm28l"> <div class="overlay left svelte-ndm28l"></div> <div class="overlay right svelte-ndm28l"></div> <div class="overlay top svelte-ndm28l"></div> <div class="overlay bottom svelte-ndm28l"></div> <div class="cropper svelte-ndm28l"><div class="top left handle svelte-ndm28l"></div> <div class="top right handle svelte-ndm28l"></div> <div class="bottom left handle svelte-ndm28l"></div> <div class="bottom right handle svelte-ndm28l"></div></div></div> <button class="upload svelte-ndm28l">Done</button> <button class="choose-again svelte-ndm28l">Choose a different image</button> <button class="cancel svelte-ndm28l">Cancel</button></div>',1);function Ot(q,v){xt(v,!0);let H=g(null),h,E,I,r=S(v,"aspectRatio",3,void 0),rt=S(v,"onupload",3,e=>{}),mt=S(v,"imageId",15,null);S(v,"circular",3,!1);let ct=It(v,["$$slots","$$events","$$legacy","aspectRatio","onupload","imageId","circular"]),_=g(1);function j(){i(H,null),i(f,null),E.style.display="none"}function gt(){I.click()}let f=g(null);function ht(){var l;if(i(f,d(((l=t(H))==null?void 0:l[0])??null)),!t(f))return;const e=new FileReader;e.onloadend=function(){E.style.display="flex",h.src=e.result;const o=h.naturalWidth/h.naturalHeight;o>1?(i(B,d(t(n).getBoundingClientRect().width)),i(y,t(B)*(1/o)),i(Y,(t(n).getBoundingClientRect().height-t(y))/2),i(_,t(n).getBoundingClientRect().height/t(y))):(i(y,d(t(n).getBoundingClientRect().height)),i(B,t(y)*o),i(X,(t(n).getBoundingClientRect().width-t(B))/2),i(_,t(n).getBoundingClientRect().width/t(B))),r()&&(r()<1?(i(m,(t(n).getBoundingClientRect().width-t(n).getBoundingClientRect().height*r())/2),i(x,d(t(m)))):(i(s,(t(n).getBoundingClientRect().height-t(n).getBoundingClientRect().width/r())/2),i(w,d(t(s)))))},t(f)?e.readAsDataURL(t(f)):h.src=""}function ut(){return t(u)/t(L)}function pt(){return new Promise((e,l)=>{const o=new Image;o.onload=()=>{const C=document.createElement("canvas");C.width=h.getBoundingClientRect().width,C.height=C.width*(1/ut());const Rt=C.getContext("2d"),U=h.naturalWidth/C.width;Rt.drawImage(o,U*(t(m)-t(X)),U*(t(s)-t(Y)),U*t(u),U*t(L),0,0,C.width,C.height),C.toBlob(dt=>{if(!dt)return l(new Error("Canvas is empty"));const _t=new File([dt],t(f).name,{type:t(f).type});e(_t)},t(f).type)},o.onerror=l;const c=new FileReader;c.onload=function(){o.src=c.result},c.onerror=l,c.readAsDataURL(t(f))})}let D,k=g(!1),b=g(null),X=g(0),Y=g(0),B=g(0),y=g(0),z,G,J,K,n=g(null),s=g(0),m=g(0),w=g(0),x=g(0),vt=1,u=P(()=>(t(s),t(w),t(n)?t(n).getBoundingClientRect().width-t(m)-t(x):0)),L=P(()=>(t(s),t(w),t(n)?t(n).getBoundingClientRect().height-t(s)-t(w):0));Xt(()=>{D.addEventListener("wheel",e=>{i(_,d(Math.min(Math.max(vt,t(_)-e.deltaY/5),10)))},!0),h.addEventListener("mousedown",()=>{i(k,!0)}),D.addEventListener("mousedown",()=>{i(k,!0)}),z.addEventListener("mousedown",()=>{i(b,"top left")}),G.addEventListener("mousedown",()=>{i(b,"top right")}),J.addEventListener("mousedown",()=>{i(b,"bottom left")}),K.addEventListener("mousedown",()=>{i(b,"bottom right")}),document.addEventListener("mousemove",e=>{if(t(b)=="top left"){const l=Math.min(e.movementX,e.movementY);if(i(m,d(Math.max(0,t(m)+l))),r()){const o=t(u)*(1/r()),c=Math.abs(t(n).getBoundingClientRect().height-o-t(w));i(s,d(c))}}else if(t(b)=="top right"){const l=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(x,d(Math.max(0,t(x)-l*Math.sign(e.movementX)))),r()){const o=t(u)*(1/r()),c=Math.abs(t(n).getBoundingClientRect().height-o-t(w));i(s,d(c))}}else if(t(b)=="bottom left"){const l=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(m,d(Math.max(0,t(m)+l*Math.sign(e.movementX)))),r()){const o=t(u)*(1/r()),c=Math.abs(t(n).getBoundingClientRect().height-o-t(s));i(w,d(c))}}else if(t(b)=="bottom right"){const l=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(x,d(Math.max(0,t(x)-l*Math.sign(e.movementX)))),r()){const o=t(u)*(1/r()),c=Math.abs(t(n).getBoundingClientRect().height-o-t(s));i(w,d(c))}}else if(t(k)){let l=t(X)+e.movementX,o=t(Y)+e.movementY;i(X,d(Math.max(Math.min(t(m),l),t(m)+t(u)-t(B)*t(_)))),i(Y,d(Math.max(Math.min(t(s),o),t(s)+t(L)-t(y)*t(_))))}},!0),document.addEventListener("mouseup",()=>{i(k,!1),i(b,null)})});const tt=P(()=>(t(m),t(s),t(n)?t(n).getBoundingClientRect().height:0)),ft=P(()=>t(n)?t(s)+t(L):0);var et=Dt(),A=Mt(et);Ht(A);let it;R(A,e=>I=e,()=>I);var N=p(A,2),T=V(N),$=V(T);R($,e=>h=e,()=>h);var O=p($,2),Q=p(O,2),W=p(Q,2),F=p(W,2),M=p(F,2),nt=V(M);R(nt,e=>z=e,()=>z);var at=p(nt,2);R(at,e=>G=e,()=>G);var ot=p(at,2);R(ot,e=>J=e,()=>J);var bt=p(ot,2);R(bt,e=>K=e,()=>K),Z(M),R(M,e=>D=e,()=>D),Z(T),R(T,e=>i(n,e),()=>t(n));var lt=p(T,2);lt.__click=[At,f,pt,mt,rt,j];var st=p(lt,2);st.__click=gt;var wt=p(st,2);wt.__click=[Ft,j],Z(N),R(N,e=>E=e,()=>E),Ct((e,l,o,c)=>{it=Et(A,it,{...ct,onchange:ht,type:"file"},"svelte-ndm28l"),a($,"cursor",t(k)?"grabbing":"grab"),a($,"left",`${t(X)??""}px`),a($,"top",`${t(Y)??""}px`),a($,"width",`${t(B)*t(_)}px`),a($,"height",`${t(y)*t(_)}px`),a(O,"width",`${e??""}px`),a(O,"height",`${t(tt)??""}px`),a(Q,"width",`${l??""}px`),a(Q,"height",`${t(tt)??""}px`),a(W,"left",`${t(m)??""}px`),a(W,"width",`${t(u)??""}px`),a(W,"height",`${o??""}px`),a(F,"right",`${t(x)??""}px`),a(F,"width",`${t(u)??""}px`),a(F,"height",`${c??""}px`),a(F,"top",`${t(ft)??""}px`),a(M,"width",`${t(u)??""}px`),a(M,"height",`${t(L)??""}px`),a(M,"top",`${t(s)??""}px`),a(M,"left",`${t(m)??""}px`),a(M,"cursor",t(k)?"grabbing":"grab")},[()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().width)??0)-t(u)-t(x)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().width)??0)-t(u)-t(m)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().height)??0)-t(L)-t(w)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().height)??0)-t(L)-t(s)}]),kt(A,()=>t(H),e=>i(H,e)),Lt(q,et),Bt()}yt(["click"]);export{Ot as I};
