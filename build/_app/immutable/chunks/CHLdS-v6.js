import{a as Rt,t as _t}from"./gFbpwaTI.js";import{p as Ct,ab as i,g as t,f as Mt,s as u,j as V,r as Z,t as Bt,a as kt,aa as d,d as P}from"./DBPlaF8E.js";import{d as yt}from"./CThlKSBW.js";import{r as Lt,s as $t}from"./CitSOB86.js";import{s as a,j as Ht}from"./BgaTf3pO.js";import{a as Et}from"./DW4Ndp52.js";import{p as S,a as l,r as It}from"./BW7aK-Zr.js";import{b as R}from"./CVPpxQ3u.js";import{o as Xt}from"./CBxwvAny.js";async function Yt(j,v,L,m,$,I){if(!t(v))return;const g=await L();m(await Ht(g)),$()(m()),I()}function Ft(j,v){v()}var At=_t('<input> <div class="preview svelte-ousx0k"><div class="image svelte-ousx0k"><img alt="User content" draggable="false" class="svelte-ousx0k"> <div class="overlay left svelte-ousx0k"></div> <div class="overlay right svelte-ousx0k"></div> <div class="overlay top svelte-ousx0k"></div> <div class="overlay bottom svelte-ousx0k"></div> <div class="cropper svelte-ousx0k"><div class="top left handle svelte-ousx0k"></div> <div class="top right handle svelte-ousx0k"></div> <div class="bottom left handle svelte-ousx0k"></div> <div class="bottom right handle svelte-ousx0k"></div></div></div> <button class="upload svelte-ousx0k">Done</button> <button class="choose-again svelte-ousx0k">Choose a different image</button> <button class="cancel svelte-ousx0k">Cancel</button></div>',1);function Gt(j,v){Ct(v,!0);let L=d(null),m,$,I,g=S(v,"aspectRatio",3,void 0),gt=S(v,"onupload",3,e=>{}),ct=S(v,"imageId",15,null);S(v,"circular",3,!1);let ht=It(v,["$$slots","$$events","$$legacy","aspectRatio","onupload","imageId","circular"]),f=d(1);function tt(){i(L,null),i(x,null),$.style.display="none"}function ut(){I.click()}let x=d(null);function mt(){var s;if(i(x,l(((s=t(L))==null?void 0:s[0])??null)),!t(x))return;const e=new FileReader;e.onloadend=function(){$.style.display="flex",m.src=e.result;const o=m.naturalWidth/m.naturalHeight;o>1?(i(M,l(t(n).getBoundingClientRect().width)),i(B,t(M)*(1/o)),i(Y,(t(n).getBoundingClientRect().height-t(B))/2),i(f,t(n).getBoundingClientRect().height/t(B)),i(K,l(t(f)))):(i(B,l(t(n).getBoundingClientRect().height)),i(M,t(B)*o),i(X,(t(n).getBoundingClientRect().width-t(M))/2),i(f,t(n).getBoundingClientRect().width/t(M)),i(K,l(t(f)))),g()&&(g()<1?(i(c,(t(n).getBoundingClientRect().width-t(n).getBoundingClientRect().height*g())/2),i(_,l(t(c)))):(i(r,(t(n).getBoundingClientRect().height-t(n).getBoundingClientRect().width/g())/2),i(w,l(t(r)))))},t(x)?e.readAsDataURL(t(x)):m.src=""}function pt(){return new Promise((e,s)=>{const o=new Image;o.onload=()=>{const y=document.createElement("canvas");y.width=t(n).getBoundingClientRect().width,y.height=t(n).getBoundingClientRect().height;const bt=y.getContext("2d"),U=m.naturalWidth/y.width;bt.drawImage(o,U*t(c),U*t(r),U*t(p),U*t(E),t(X),t(Y),y.width,y.height),y.toBlob(dt=>{if(!dt)return s(new Error("Canvas is empty"));const wt=new File([dt],t(x).name,{type:t(x).type});e(wt)},t(x).type)},o.onerror=s;const h=new FileReader;h.onload=function(){o.src=h.result},h.onerror=s,h.readAsDataURL(t(x))})}let D,H=d(!1),b=d(null),X=d(0),Y=d(0),M=d(0),B=d(0),q,z,G,J,n=d(null),r=d(0),c=d(0),w=d(0),_=d(0),K=d(1),p=P(()=>(t(r),t(w),t(n)?t(n).getBoundingClientRect().width-t(c)-t(_):0)),E=P(()=>(t(r),t(w),t(n)?t(n).getBoundingClientRect().height-t(r)-t(w):0));Xt(()=>{D.addEventListener("wheel",e=>{i(f,l(Math.min(Math.max(t(K),t(f)-e.deltaY/5),10)))},!0),m.addEventListener("mousedown",()=>{i(H,!0)}),D.addEventListener("mousedown",()=>{i(H,!0)}),q.addEventListener("mousedown",()=>{i(b,"top left")}),z.addEventListener("mousedown",()=>{i(b,"top right")}),G.addEventListener("mousedown",()=>{i(b,"bottom left")}),J.addEventListener("mousedown",()=>{i(b,"bottom right")}),document.addEventListener("mousemove",e=>{if(t(b)=="top left"){const s=Math.min(e.movementX,e.movementY);if(i(c,l(Math.max(0,t(c)+s))),g()){const o=t(p)*(1/g()),h=Math.abs(t(n).getBoundingClientRect().height-o-t(w));i(r,l(h))}}else if(t(b)=="top right"){const s=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(_,l(Math.max(0,t(_)-s*Math.sign(e.movementX)))),g()){const o=t(p)*(1/g()),h=Math.abs(t(n).getBoundingClientRect().height-o-t(w));i(r,l(h))}}else if(t(b)=="bottom left"){const s=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(c,l(Math.max(0,t(c)+s*Math.sign(e.movementX)))),g()){const o=t(p)*(1/g()),h=Math.abs(t(n).getBoundingClientRect().height-o-t(r));i(w,l(h))}}else if(t(b)=="bottom right"){const s=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(_,l(Math.max(0,t(_)-s*Math.sign(e.movementX)))),g()){const o=t(p)*(1/g()),h=Math.abs(t(n).getBoundingClientRect().height-o-t(r));i(w,l(h))}}else if(t(H)){let s=t(X)+e.movementX,o=t(Y)+e.movementY;i(X,l(Math.max(Math.min(t(c),s),t(c)+t(p)-t(M)*t(f)))),i(Y,l(Math.max(Math.min(t(r),o),t(r)+t(E)-t(B)*t(f))))}},!0),document.addEventListener("mouseup",()=>{i(H,!1),i(b,null)})});const et=P(()=>(t(c),t(r),t(n)?t(n).getBoundingClientRect().height:0)),vt=P(()=>t(n)?t(r)+t(E):0);var it=At(),F=Mt(it);Lt(F);let nt;R(F,e=>I=e,()=>I);var N=u(F,2),T=V(N),k=V(T);R(k,e=>m=e,()=>m);var O=u(k,2),Q=u(O,2),W=u(Q,2),A=u(W,2),C=u(A,2),at=V(C);R(at,e=>q=e,()=>q);var ot=u(at,2);R(ot,e=>z=e,()=>z);var st=u(ot,2);R(st,e=>G=e,()=>G);var ft=u(st,2);R(ft,e=>J=e,()=>J),Z(C),R(C,e=>D=e,()=>D),Z(T),R(T,e=>i(n,e),()=>t(n));var lt=u(T,2);lt.__click=[Yt,x,pt,ct,gt,tt];var rt=u(lt,2);rt.__click=ut;var xt=u(rt,2);xt.__click=[Ft,tt],Z(N),R(N,e=>$=e,()=>$),Bt((e,s,o,h)=>{nt=$t(F,nt,{...ht,onchange:mt,type:"file"},"svelte-ousx0k"),a(k,"cursor",t(H)?"grabbing":"grab"),a(k,"left",`${t(X)??""}px`),a(k,"top",`${t(Y)??""}px`),a(k,"width",`${t(M)*t(f)}px`),a(k,"height",`${t(B)*t(f)}px`),a(O,"width",`${e??""}px`),a(O,"height",`${t(et)??""}px`),a(Q,"width",`${s??""}px`),a(Q,"height",`${t(et)??""}px`),a(W,"left",`${t(c)??""}px`),a(W,"width",`${t(p)??""}px`),a(W,"height",`${o??""}px`),a(A,"right",`${t(_)??""}px`),a(A,"width",`${t(p)??""}px`),a(A,"height",`${h??""}px`),a(A,"top",`${t(vt)??""}px`),a(C,"width",`${t(p)??""}px`),a(C,"height",`${t(E)??""}px`),a(C,"top",`${t(r)??""}px`),a(C,"left",`${t(c)??""}px`),a(C,"cursor",t(H)?"grabbing":"grab")},[()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().width)??0)-t(p)-t(_)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().width)??0)-t(p)-t(c)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().height)??0)-t(E)-t(w)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().height)??0)-t(E)-t(r)}]),Et(F,()=>t(L),e=>i(L,e)),Rt(j,it),kt()}yt(["click"]);export{Gt as I};
