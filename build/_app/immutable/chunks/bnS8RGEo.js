import{a as xt,t as Mt}from"./gFbpwaTI.js";import{p as Ct,ab as i,g as t,f as Bt,s as p,j as Q,r as V,t as yt,a as Lt,aa as g,d as P}from"./DBPlaF8E.js";import{d as $t}from"./CThlKSBW.js";import{r as Ht,s as Et}from"./o2l4qZHV.js";import{s as a,j as It}from"./9khlPRwb.js";import{a as Xt}from"./BEmAISS_.js";import{p as S,a as d,r as kt}from"./BW7aK-Zr.js";import{b as R}from"./CVPpxQ3u.js";import{o as Yt}from"./CBxwvAny.js";async function At(j,v,H,h,E,X){if(!t(v))return;const r=await H();h(await It(r)),E()(h()),X()}function Ft(j,v){v()}var Dt=Mt('<input> <div class="preview svelte-ndm28l"><div class="image svelte-ndm28l"><img alt="User content" draggable="false" class="svelte-ndm28l"> <div class="overlay left svelte-ndm28l"></div> <div class="overlay right svelte-ndm28l"></div> <div class="overlay top svelte-ndm28l"></div> <div class="overlay bottom svelte-ndm28l"></div> <div class="cropper svelte-ndm28l"><div class="top left handle svelte-ndm28l"></div> <div class="top right handle svelte-ndm28l"></div> <div class="bottom left handle svelte-ndm28l"></div> <div class="bottom right handle svelte-ndm28l"></div></div></div> <button class="upload svelte-ndm28l">Done</button> <button class="choose-again svelte-ndm28l">Choose a different image</button> <button class="cancel svelte-ndm28l">Cancel</button></div>',1);function Jt(j,v){Ct(v,!0);let H=g(null),h,E,X,r=S(v,"aspectRatio",3,void 0),rt=S(v,"onupload",3,e=>{}),mt=S(v,"imageId",15,null);S(v,"circular",3,!1);let ct=kt(v,["$$slots","$$events","$$legacy","aspectRatio","onupload","imageId","circular"]),_=g(1);function Z(){i(H,null),i(f,null),E.style.display="none"}function gt(){X.click()}let f=g(null);function ht(){var l;if(i(f,d(((l=t(H))==null?void 0:l[0])??null)),!t(f))return;const e=new FileReader;e.onloadend=function(){E.style.display="flex",h.src=e.result;const o=h.naturalWidth/h.naturalHeight;o>1?(i(B,d(t(n).getBoundingClientRect().width)),i(y,t(B)*(1/o)),i(Y,(t(n).getBoundingClientRect().height-t(y))/2),i(_,t(n).getBoundingClientRect().height/t(y))):(i(y,d(t(n).getBoundingClientRect().height)),i(B,t(y)*o),i(k,(t(n).getBoundingClientRect().width-t(B))/2),i(_,t(n).getBoundingClientRect().width/t(B))),r()&&(r()<1?(i(m,(t(n).getBoundingClientRect().width-t(n).getBoundingClientRect().height*r())/2),i(x,d(t(m)))):(i(s,(t(n).getBoundingClientRect().height-t(n).getBoundingClientRect().width/r())/2),i(w,d(t(s)))))},t(f)?e.readAsDataURL(t(f)):h.src=""}function ut(){return t(u)/t(L)}function pt(){return new Promise((e,l)=>{const o=new Image;o.onload=()=>{const C=document.createElement("canvas");C.width=h.getBoundingClientRect().width,C.height=C.width*(1/ut());const Rt=C.getContext("2d"),U=h.naturalWidth/C.width;Rt.drawImage(o,U*(t(m)-t(k)),U*(t(s)-t(Y)),U*t(u),U*t(L),0,0,C.width,C.height),C.toBlob(dt=>{if(!dt)return l(new Error("Canvas is empty"));const _t=new File([dt],t(f).name,{type:t(f).type});e(_t)},t(f).type)},o.onerror=l;const c=new FileReader;c.onload=function(){o.src=c.result},c.onerror=l,c.readAsDataURL(t(f))})}let D,I=g(!1),b=g(null),k=g(0),Y=g(0),B=g(0),y=g(0),q,z,G,J,n=g(null),s=g(0),m=g(0),w=g(0),x=g(0),vt=1,u=P(()=>(t(s),t(w),t(n)?t(n).getBoundingClientRect().width-t(m)-t(x):0)),L=P(()=>(t(s),t(w),t(n)?t(n).getBoundingClientRect().height-t(s)-t(w):0));Yt(()=>{D.addEventListener("wheel",e=>{i(_,d(Math.min(Math.max(vt,t(_)-e.deltaY/5),10)))},!0),h.addEventListener("mousedown",()=>{i(I,!0)}),D.addEventListener("mousedown",()=>{i(I,!0)}),q.addEventListener("mousedown",()=>{i(b,"top left")}),z.addEventListener("mousedown",()=>{i(b,"top right")}),G.addEventListener("mousedown",()=>{i(b,"bottom left")}),J.addEventListener("mousedown",()=>{i(b,"bottom right")}),document.addEventListener("mousemove",e=>{if(t(b)=="top left"){const l=Math.min(e.movementX,e.movementY);if(i(m,d(Math.max(0,t(m)+l))),r()){const o=t(u)*(1/r()),c=Math.abs(t(n).getBoundingClientRect().height-o-t(w));i(s,d(c))}}else if(t(b)=="top right"){const l=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(x,d(Math.max(0,t(x)-l*Math.sign(e.movementX)))),r()){const o=t(u)*(1/r()),c=Math.abs(t(n).getBoundingClientRect().height-o-t(w));i(s,d(c))}}else if(t(b)=="bottom left"){const l=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(m,d(Math.max(0,t(m)+l*Math.sign(e.movementX)))),r()){const o=t(u)*(1/r()),c=Math.abs(t(n).getBoundingClientRect().height-o-t(s));i(w,d(c))}}else if(t(b)=="bottom right"){const l=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(x,d(Math.max(0,t(x)-l*Math.sign(e.movementX)))),r()){const o=t(u)*(1/r()),c=Math.abs(t(n).getBoundingClientRect().height-o-t(s));i(w,d(c))}}else if(t(I)){let l=t(k)+e.movementX,o=t(Y)+e.movementY;i(k,d(Math.max(Math.min(t(m),l),t(m)+t(u)-t(B)*t(_)))),i(Y,d(Math.max(Math.min(t(s),o),t(s)+t(L)-t(y)*t(_))))}},!0),document.addEventListener("mouseup",()=>{i(I,!1),i(b,null)})});const tt=P(()=>(t(m),t(s),t(n)?t(n).getBoundingClientRect().height:0)),ft=P(()=>t(n)?t(s)+t(L):0);var et=Dt(),A=Bt(et);Ht(A);let it;R(A,e=>X=e,()=>X);var K=p(A,2),T=Q(K),$=Q(T);R($,e=>h=e,()=>h);var N=p($,2),O=p(N,2),W=p(O,2),F=p(W,2),M=p(F,2),nt=Q(M);R(nt,e=>q=e,()=>q);var at=p(nt,2);R(at,e=>z=e,()=>z);var ot=p(at,2);R(ot,e=>G=e,()=>G);var bt=p(ot,2);R(bt,e=>J=e,()=>J),V(M),R(M,e=>D=e,()=>D),V(T),R(T,e=>i(n,e),()=>t(n));var lt=p(T,2);lt.__click=[At,f,pt,mt,rt,Z];var st=p(lt,2);st.__click=gt;var wt=p(st,2);wt.__click=[Ft,Z],V(K),R(K,e=>E=e,()=>E),yt((e,l,o,c)=>{it=Et(A,it,{...ct,onchange:ht,type:"file"},"svelte-ndm28l"),a($,"cursor",t(I)?"grabbing":"grab"),a($,"left",`${t(k)??""}px`),a($,"top",`${t(Y)??""}px`),a($,"width",`${t(B)*t(_)}px`),a($,"height",`${t(y)*t(_)}px`),a(N,"width",`${e??""}px`),a(N,"height",`${t(tt)??""}px`),a(O,"width",`${l??""}px`),a(O,"height",`${t(tt)??""}px`),a(W,"left",`${t(m)??""}px`),a(W,"width",`${t(u)??""}px`),a(W,"height",`${o??""}px`),a(F,"right",`${t(x)??""}px`),a(F,"width",`${t(u)??""}px`),a(F,"height",`${c??""}px`),a(F,"top",`${t(ft)??""}px`),a(M,"width",`${t(u)??""}px`),a(M,"height",`${t(L)??""}px`),a(M,"top",`${t(s)??""}px`),a(M,"left",`${t(m)??""}px`),a(M,"cursor",t(I)?"grabbing":"grab")},[()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().width)??0)-t(u)-t(x)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().width)??0)-t(u)-t(m)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().height)??0)-t(L)-t(w)},()=>{var e;return(((e=t(n))==null?void 0:e.getBoundingClientRect().height)??0)-t(L)-t(s)}]),Xt(A,()=>t(H),e=>i(H,e)),xt(j,et),Lt()}$t(["click"]);export{Jt as I};
