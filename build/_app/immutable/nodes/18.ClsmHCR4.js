import"../chunks/Bg9kRutz.js";import{p as Ye,aa as n,g as e,f as _e,s,j as g,r as f,t as K,a as Xe,a9 as d,d as Ce}from"../chunks/WN_fbJpe.js";import{s as Ne}from"../chunks/ByX55g6p.js";import{u as Ae,a as Le,F as Te,g as Ue}from"../chunks/C-nvkwG9.js";import{p as qe,a as ie,r as We,i as we}from"../chunks/CekrD1oI.js";import{e as je,i as Ge}from"../chunks/mN0-zi8w.js";import{a as M,t as D,c as Je}from"../chunks/BuWQ83nl.js";import{r as $e,s as Ke,b as Oe}from"../chunks/28WtC1qK.js";import{d as ze,j as Qe}from"../chunks/Br4vGdAM.js";import{s as a,q as He,r as Ee,e as Ve,t as I,d as Ze}from"../chunks/B1anyXML.js";import{a as et,b as Me}from"../chunks/BxgKVALl.js";import{b as E}from"../chunks/DLYLBWAV.js";import{g as Pe}from"../chunks/Chv6-rHi.js";import{E as De}from"../chunks/DOAcsm31.js";import{B as tt}from"../chunks/C0ksvMGU.js";import{B as at}from"../chunks/eaKratRw.js";import{o as st}from"../chunks/8cpL518U.js";import{P as nt}from"../chunks/B-8HA--T.js";import{R as he}from"../chunks/-7vO4wkI.js";async function rt(Z,x,v,c,u,h,C){if(!e(x))return;const S=await v(e(x),parseInt(e(c)),parseInt(e(u)),parseInt(e(h)),parseInt(e(C))),F=await Ae(S);await He({picture:F}),Pe("/profile")}var ot=D('<input> <div class="preview svelte-ttdpte"><div class="image svelte-ttdpte"><img alt="User content" draggable="false" class="svelte-ttdpte"> <div class="overlay left svelte-ttdpte"></div> <div class="overlay right svelte-ttdpte"></div> <div class="overlay top svelte-ttdpte"></div> <div class="overlay bottom svelte-ttdpte"></div> <div class="cropper svelte-ttdpte"><div class="top left handle svelte-ttdpte"></div> <div class="top right handle svelte-ttdpte"></div> <div class="bottom left handle svelte-ttdpte"></div> <div class="bottom right handle svelte-ttdpte"></div></div></div> <button class="upload svelte-ttdpte">Done</button> <button class="choose-again svelte-ttdpte">Choose a different image</button> <button class="cancel svelte-ttdpte">Cancel</button></div>',1);function lt(Z,x){Ye(x,!0);let v=d(null),c,u,h;qe(x,"aspectRatio",3,null);let C=We(x,["$$slots","$$events","$$legacy","aspectRatio"]),S=d(2);function F(){n(v,null),n(Y,null),u.style.display="none"}function xe(){h.click()}let Y=d(null);function Re(){var o;if(n(Y,ie(((o=e(v))==null?void 0:o[0])??null)),!e(Y))return;const t=new FileReader;t.onloadend=function(){u.style.display="flex",c.src=t.result,n(B,`${e(p).getBoundingClientRect().width}px`),n(z,`${e(p).getBoundingClientRect().height}px`)},e(Y)?t.readAsDataURL(e(Y)):c.src=""}function N(t,o,ne,j,G){return new Promise((ge,J)=>{const re=new Image;re.onload=()=>{const le=document.createElement("canvas");le.width=j,le.height=G,le.getContext("2d").drawImage(re,o,ne,j,G,0,0,j,G),le.toBlob(l=>{if(!l)return J(new Error("Canvas is empty"));const i=new File([l],t.name,{type:t.type});ge(i)},t.type)},re.onerror=J;const oe=new FileReader;oe.onload=function(){re.src=oe.result},oe.onerror=J,oe.readAsDataURL(t)})}let pe,X=d(!1),k=d(null),O=d("0px"),de=d("0px"),Q,y,ee,A,p=d(null),w=d("0px"),_=d("0px"),$=d("0px"),R=d("0px"),B=Ce(()=>e(p)?`${e(p).getBoundingClientRect().width-parseInt(e(_))-parseInt(e(R))}px`:"0px"),z=Ce(()=>e(p)?`${e(p).getBoundingClientRect().height-parseInt(e(w))-parseInt(e($))}px`:"0px");st(()=>{pe.addEventListener("wheel",t=>{n(S,ie(Math.min(Math.max(1,e(S)-t.deltaY/5),10)))},!0),c.addEventListener("mousedown",()=>{n(X,!0)}),pe.addEventListener("mousedown",()=>{n(X,!0)}),Q.addEventListener("mousedown",()=>{n(k,"top left")}),y.addEventListener("mousedown",()=>{n(k,"top right")}),ee.addEventListener("mousedown",()=>{n(k,"bottom left")}),A.addEventListener("mousedown",()=>{n(k,"bottom right")}),document.addEventListener("mousemove",t=>{if(e(k)=="top left"){const o=Math.min(t.movementX,t.movementY);n(_,`${Math.max(0,parseInt(e(_))+o)}px`),n(w,`${Math.max(0,parseInt(e(w))+o)}px`)}else if(e(k)=="top right"){const o=Math.min(Math.abs(t.movementX),Math.abs(t.movementY));n(R,`${Math.max(0,parseInt(e(R))-o*Math.sign(t.movementX))}px`),n(w,`${Math.max(0,parseInt(e(w))+o*Math.sign(t.movementY))}px`)}else if(e(k)=="bottom left"){const o=Math.min(Math.abs(t.movementX),Math.abs(t.movementY));n(_,`${Math.max(0,parseInt(e(_))+o*Math.sign(t.movementX))}px`),n($,`${Math.max(0,parseInt(e($))-o*Math.sign(t.movementY))}px`)}else if(e(k)=="bottom right"){const o=Math.min(Math.abs(t.movementX),Math.abs(t.movementY));n(R,`${Math.max(0,parseInt(e(R))-o*Math.sign(t.movementX))}px`),n($,`${Math.max(0,parseInt(e($))-o*Math.sign(t.movementY))}px`)}else e(X)&&(n(O,`${parseInt(e(O))+t.movementX}px`),n(de,`${parseInt(e(de))+t.movementY}px`))},!0),document.addEventListener("mouseup",()=>{n(X,!1),n(k,null)})});const ve=Ce(()=>(e(_),e(p)?e(p).getBoundingClientRect().height:0));var T=ot(),U=_e(T);$e(U);let q;E(U,t=>h=t,()=>h);var te=s(U,2),L=g(te),H=g(L);E(H,t=>c=t,()=>c);var ae=s(H,2),ce=s(ae,2),V=s(ce,2),W=s(V,2),m=s(W,2),se=g(m);E(se,t=>Q=t,()=>Q);var ue=s(se,2);E(ue,t=>y=t,()=>y);var ke=s(ue,2);E(ke,t=>ee=t,()=>ee);var me=s(ke,2);E(me,t=>A=t,()=>A),f(m),E(m,t=>pe=t,()=>pe),f(L),E(L,t=>n(p,t),()=>e(p));var be=s(L,2);be.__click=[rt,Y,N,_,w,B,z];var ye=s(be,2);ye.__click=xe;var Ie=s(ye,2);Ie.__click=F,f(te),E(te,t=>u=t,()=>u),K((t,o,ne,j,G,ge,J)=>{q=Ke(U,q,{...C,onchange:Re,type:"file"},"svelte-ttdpte"),a(H,"cursor",e(X)?"grabbing":"grab"),a(H,"scale",e(S)),a(H,"left",e(O)),a(H,"top",e(de)),a(ae,"width",`${t??""}px`),a(ae,"height",`${e(ve)??""}px`),a(ce,"width",`${o??""}px`),a(ce,"height",`${e(ve)??""}px`),a(V,"left",`${ne??""}px`),a(V,"width",e(B)),a(V,"height",`${j??""}px`),a(W,"right",`${G??""}px`),a(W,"width",e(B)),a(W,"height",`${ge??""}px`),a(W,"top",`${J??""}px`),a(m,"width",e(B)),a(m,"height",e(z)),a(m,"top",e(w)),a(m,"left",e(_)),a(m,"cursor",e(X)?"grabbing":"grab")},[()=>{var t;return(((t=e(p))==null?void 0:t.getBoundingClientRect().width)??0)-parseInt(e(B))-parseInt(e(R))},()=>{var t;return(((t=e(p))==null?void 0:t.getBoundingClientRect().width)??0)-parseInt(e(B))-parseInt(e(_))},()=>parseInt(e(_)),()=>{var t;return(((t=e(p))==null?void 0:t.getBoundingClientRect().height)??0)-parseInt(e(z))-parseInt(e($))},()=>parseInt(e(R)),()=>{var t;return(((t=e(p))==null?void 0:t.getBoundingClientRect().height)??0)-parseInt(e(z))-parseInt(e(w))},()=>parseInt(e(z))+parseInt(e(w))]),et(U,()=>e(v),t=>n(v,t)),M(Z,T),Xe()}ze(["click"]);function it(Z,x){n(x,!1)}async function Fe(Z,x,v,c,u,h,C){if(!(e(x).length>0)){if(e(v)!==(await Ee).username&&await Ve(e(v))){n(c,!0);return}await He({displayName:e(u),bio:e(h),username:e(v),pronouns:e(C)}),await Pe("/profile"),location.reload()}}var pt=D('<label for="set-profile-picture" class="profile-picture svelte-1lbn6sk"><div class="overlay svelte-1lbn6sk"></div> <!></label>'),dt=D('<span class="error svelte-1lbn6sk"> </span>'),vt=D('<span class="error svelte-1lbn6sk">Username already taken</span>'),ct=D('<span class="badge-line svelte-1lbn6sk">Show developer badge <!></span>'),ut=D('<span class="badge-line svelte-1lbn6sk">Show moderator badge <!></span>'),mt=D('<span class="badge-line svelte-1lbn6sk">Show moderator badge <!></span>'),bt=D('<button class="banner svelte-1lbn6sk"><!> <div class="overlay svelte-1lbn6sk"></div> <!></button> <div class="profile svelte-1lbn6sk"><div><!> <!> <button class="save svelte-1lbn6sk">Save</button></div> <label for="display-name" class="svelte-1lbn6sk">Display Name</label> <input type="text" id="display-name" class="svelte-1lbn6sk"> <label for="username" class="svelte-1lbn6sk">Username</label> <div class="username svelte-1lbn6sk"><span class="at svelte-1lbn6sk">@</span> <input type="text" id="username" class="svelte-1lbn6sk"></div> <!> <!> <hr class="svelte-1lbn6sk"> <label for="pronouns" class="svelte-1lbn6sk">Pronouns</label> <input type="text" id="pronouns" class="svelte-1lbn6sk"> <span class="radio-input svelte-1lbn6sk"><label for="display-pronouns" class="svelte-1lbn6sk">Display pronouns on your profile</label> <!></span> <span class="radio-input svelte-1lbn6sk"><label for="display-post-pronouns" class="svelte-1lbn6sk">Display pronouns on your posts</label> <!></span> <hr class="svelte-1lbn6sk"> <label for="bio" class="svelte-1lbn6sk">Bio</label> <textarea class="bio svelte-1lbn6sk" id="bio"></textarea> <hr class="svelte-1lbn6sk"> <label class="svelte-1lbn6sk">Badges</label> <!> <!> <!></div>',1),gt=D('<!> <button class="save-bottom svelte-1lbn6sk">Save</button> <!>',1),ft=D("<!> <!>",1);function Ht(Z,x){Ye(x,!0),Ee.then(N=>{n(v,ie(N.displayName)),n(c,ie(N.username)),n(u,ie(N.bio)),n(h,ie(N.pronouns))});let v=d(""),c=d(""),u=d(""),h=d(""),C=Ce(()=>Ze(e(c))),S,F=d(!1);var xe=ft(),Y=_e(xe);at(Y);var Re=s(Y,2);nt(Re,{children:(N,pe)=>{var X=gt(),k=_e(X);Le(k,()=>Ee,null,(Q,y)=>{var ee=bt(),A=_e(ee),p=g(A);tt(p,{style:"position: absolute; top: 0.5rem; left: 0.5rem;"});var w=s(p,4);De(w,{stroke:"#CCCCFF",style:"position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 3rem; height: 3rem; z-index: 4;"}),f(A);var _=s(A,2),$=g(_),R=g($);Le(R,()=>Ue(e(y).picture),null,(r,l)=>{var i=pt(),b=s(g(i),2);De(b,{stroke:"#CCCCFF",style:"position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 2rem; height: 2rem; z-index: 4;"}),f(i),K(P=>{a(i,"border-color",P),a(i,"background-image",`url('${e(l)??""}')`)},[()=>I().background]),M(r,i)});var B=s(R,2);lt(B,{id:"set-profile-picture"});var z=s(B,2);z.__click=[Fe,C,c,F,v,u,h],f($);var ve=s($,2),T=s(ve,2);$e(T);var U=s(T,2),q=s(U,2),te=g(q),L=s(te,2);$e(L),L.__input=[it,F],E(L,r=>S=r,()=>S),f(q);var H=s(q,2);Le(H,()=>e(C),null,(r,l)=>{var i=Je(),b=_e(i);je(b,17,()=>e(l),Ge,(P,fe)=>{var Be=dt(),Se=g(Be,!0);f(Be),K(()=>Ne(Se,e(fe))),M(P,Be)}),M(r,i)});var ae=s(H,2);{var ce=r=>{var l=vt();M(r,l)};we(ae,r=>{e(F)&&r(ce)})}var V=s(ae,2),W=s(V,2),m=s(W,2);$e(m);var se=s(m,2),ue=g(se),ke=s(ue,2);he(ke,{id:"display-pronouns",size:.7}),f(se);var me=s(se,2),be=g(me),ye=s(be,2);he(ye,{id:"display-post-pronouns",size:.7}),f(me);var Ie=s(me,2),t=s(Ie,2),o=s(t,2);Qe(o);var ne=s(o,2),j=s(ne,2),G=s(j,2);{var ge=r=>{var l=ct(),i=s(g(l));he(i,{size:.6}),f(l),K(b=>a(l,"color",b),[()=>I().textDull]),M(r,l)};we(G,r=>{e(y).tags.includes("dev")&&r(ge)})}var J=s(G,2);{var re=r=>{var l=ut(),i=s(g(l));he(i,{size:.6}),f(l),K(b=>a(l,"color",b),[()=>I().textDull]),M(r,l)};we(J,r=>{e(y).tags.includes("mod")&&r(re)})}var oe=s(J,2);{var le=r=>{var l=mt(),i=s(g(l));he(i,{size:.6}),f(l),K(b=>a(l,"color",b),[()=>I().textDull]),M(r,l)};we(oe,r=>{e(y).tags.includes("developer")&&r(le)})}f(_),K((r,l,i,b,P,fe)=>{a(A,"background-image",`url('${e(y).banner??""}')`),a(z,"background",`linear-gradient(${r??""}, ${l??""})`),a(ve,"color",i),a(T,"background",b),a(T,"color",P),a(U,"color",i),a(q,"outline",e(F)||e(C).length>0?"2px solid indianred":"none"),a(q,"background",b),a(te,"color",P),a(L,"color",P),a(V,"background",fe),a(W,"color",i),a(m,"background",b),a(m,"color",P),a(ue,"color",i),a(be,"color",i),a(Ie,"background",fe),a(t,"color",i),Oe(o,`				${e(y).bio??""}
			`),a(o,"color",P),a(o,"background",b),a(ne,"background",fe),a(j,"color",i)},[()=>I().accent,()=>I().accent2,()=>I().textDull,()=>I().backgroundDark,()=>I().text,()=>I().textDark]),Me(T,()=>e(v),r=>n(v,r)),Me(L,()=>e(c),r=>n(c,r)),Me(m,()=>e(h),r=>n(h,r)),Me(o,()=>e(u),r=>n(u,r)),M(Q,ee)});var O=s(k,2);O.__click=[Fe,C,c,F,v,u,h];var de=s(O,2);Te(de,{selected:"profile"}),K((Q,y)=>a(O,"background",`linear-gradient(${Q??""}, ${y??""})`),[()=>I().accent,()=>I().accent2]),M(N,X)},$$slots:{default:!0}}),M(Z,xe),Xe()}ze(["click","input"]);export{Ht as component};
