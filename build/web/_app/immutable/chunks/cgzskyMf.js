import"./Bzak7iHL.js";import{o as jt}from"./DGkc4AeD.js";import{p as $t,ac as i,j as t,a9 as c,ab as F,a6 as Et,f as Ht,d as h,e as N,r as O,t as It,a as Xt,g as kt}from"./DhKu0NfF.js";import{d as Yt}from"./DGKU-49f.js";import{r as At,a as Ft,b as z,c as Dt}from"./COSmXfxt.js";import{a as Tt}from"./CmLPpUp4.js";import{p as X,r as Wt,b}from"./DZzuPxtn.js";import{u as vt}from"./CfePtEBp.js";async function Ut(D,m,R,u,B,j){if(!t(m))return;const r=await R();u(await vt(r)),B()(u()),j()}function Pt(D,m){m()}var St=Et('<input/> <div class="preview svelte-10j4zly"><div class="image svelte-10j4zly"><img alt="User content" draggable="false" class="svelte-10j4zly"/> <div class="overlay left svelte-10j4zly"></div> <div class="overlay right svelte-10j4zly"></div> <div class="overlay top svelte-10j4zly"></div> <div class="overlay bottom svelte-10j4zly"></div> <div><div class="top left handle svelte-10j4zly"></div> <div class="top right handle svelte-10j4zly"></div> <div class="bottom left handle svelte-10j4zly"></div> <div class="bottom right handle svelte-10j4zly"></div></div></div> <button class="upload svelte-10j4zly">Done</button> <button class="choose-again svelte-10j4zly">Choose a different image</button> <button class="cancel svelte-10j4zly">Cancel</button></div>',1);function Zt(D,m){$t(m,!0);let R=c(null),u,B,j,r=X(m,"aspectRatio",3,void 0),Q=X(m,"onupload",3,e=>{}),T=X(m,"imageId",15,null),ft=X(m,"circular",3,!1),wt=X(m,"allowEdit",3,!0),bt=Wt(m,["$$slots","$$events","$$legacy","aspectRatio","onupload","imageId","circular","allowEdit"]),y=c(1);function W(){i(R,null),i(p,null),B.style.display="none"}function yt(){j.click()}let p=c(null);async function _t(){var o,l;if(!wt()){const a=((o=t(R))==null?void 0:o[0])??null;if(!a)return;T(await vt(a)),Q()(T()),W()}if(i(p,((l=t(R))==null?void 0:l[0])??null,!0),!t(p))return;const e=new FileReader;e.onloadend=function(){B.style.display="flex",u.src=e.result;const a=u.naturalWidth/u.naturalHeight;a>1?(i(x,t(n).getBoundingClientRect().width,!0),i(M,t(x)*(1/a)),i(E,(t(n).getBoundingClientRect().height-t(M))/2),i(y,t(n).getBoundingClientRect().height/t(M))):(i(M,t(n).getBoundingClientRect().height,!0),i(x,t(M)*a),i($,(t(n).getBoundingClientRect().width-t(x))/2),i(y,t(n).getBoundingClientRect().width/t(x))),r()&&(r()<1?(i(d,(t(n).getBoundingClientRect().width-t(n).getBoundingClientRect().height*r())/2),i(_,t(d),!0)):(i(s,(t(n).getBoundingClientRect().height-t(n).getBoundingClientRect().width/r())/2),i(w,t(s),!0)))},t(p)?e.readAsDataURL(t(p)):u.src=""}function Rt(){return t(g)/t(C)}function xt(){return new Promise((e,o)=>{const l=new Image;l.onload=()=>{const v=document.createElement("canvas");v.width=u.getBoundingClientRect().width,v.height=v.width*(1/Rt());const K=v.getContext("2d"),A=u.naturalWidth/v.width;K.drawImage(l,A*(t(d)-t($)),A*(t(s)-t(E)),A*t(g),A*t(C),0,0,v.width,v.height),v.toBlob(pt=>{if(!pt)return o(new Error("Canvas is empty"));const zt=new File([pt],t(p).name,{type:t(p).type});e(zt)},t(p).type)},l.onerror=o;const a=new FileReader;a.onload=function(){l.src=a.result},a.onerror=o,a.readAsDataURL(t(p))})}let k,L=c(!1),f=c(null),$=c(0),E=c(0),x=c(0),M=c(0),U,P,S,q,n=c(null),s=c(0),d=c(0),w=c(0),_=c(0),Mt=1,g=F(()=>(t(s),t(w),t(n)?t(n).getBoundingClientRect().width-t(d)-t(_):0)),C=F(()=>(t(s),t(w),t(n)?t(n).getBoundingClientRect().height-t(s)-t(w):0));jt(()=>{k.addEventListener("wheel",e=>{i(y,Math.min(Math.max(Mt,t(y)-e.deltaY/5),10),!0)},!0),u.addEventListener("mousedown",()=>{i(L,!0)}),k.addEventListener("mousedown",()=>{i(L,!0)}),U.addEventListener("mousedown",()=>{i(f,"top left")}),P.addEventListener("mousedown",()=>{i(f,"top right")}),S.addEventListener("mousedown",()=>{i(f,"bottom left")}),q.addEventListener("mousedown",()=>{i(f,"bottom right")}),document.addEventListener("mousemove",e=>{if(t(f)=="top left"){const o=Math.min(e.movementX,e.movementY);if(i(d,Math.max(0,t(d)+o),!0),r()){const l=t(g)*(1/r()),a=Math.abs(t(n).getBoundingClientRect().height-l-t(w));i(s,a,!0)}}else if(t(f)=="top right"){const o=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(_,Math.max(0,t(_)-o*Math.sign(e.movementX)),!0),r()){const l=t(g)*(1/r()),a=Math.abs(t(n).getBoundingClientRect().height-l-t(w));i(s,a,!0)}}else if(t(f)=="bottom left"){const o=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(d,Math.max(0,t(d)+o*Math.sign(e.movementX)),!0),r()){const l=t(g)*(1/r()),a=Math.abs(t(n).getBoundingClientRect().height-l-t(s));i(w,a,!0)}}else if(t(f)=="bottom right"){const o=Math.min(Math.abs(e.movementX),Math.abs(e.movementY));if(i(_,Math.max(0,t(_)-o*Math.sign(e.movementX)),!0),r()){const l=t(g)*(1/r()),a=Math.abs(t(n).getBoundingClientRect().height-l-t(s));i(w,a,!0)}}else if(t(L)){let o=t($)+e.movementX,l=t(E)+e.movementY;i($,Math.max(Math.min(t(d),o),t(d)+t(g)-t(x)*t(y)),!0),i(E,Math.max(Math.min(t(s),l),t(s)+t(C)-t(M)*t(y)),!0)}},!0),document.addEventListener("mouseup",()=>{i(L,!1),i(f,null)})});const V=F(()=>(t(d),t(s),t(n)?t(n).getBoundingClientRect().height:0)),Ct=F(()=>t(n)?t(s)+t(C):0);var Z=St(),H=Ht(Z);At(H),Ft(H,()=>({...bt,onchange:_t,type:"file"}),void 0,void 0,"svelte-10j4zly"),b(H,e=>j=e,()=>j);var G=h(H,2),Y=N(G),J=N(Y);let tt;b(J,e=>u=e,()=>u);var et=h(J,2);let it;var nt=h(et,2);let at;var lt=h(nt,2);let ot;var st=h(lt,2);let rt;var I=h(st,2);let dt;var ct=N(I);b(ct,e=>U=e,()=>U);var ut=h(ct,2);b(ut,e=>P=e,()=>P);var gt=h(ut,2);b(gt,e=>S=e,()=>S);var Bt=h(gt,2);b(Bt,e=>q=e,()=>q),O(I),b(I,e=>k=e,()=>k),O(Y),b(Y,e=>i(n,e),()=>t(n));var ht=h(Y,2);ht.__click=[Ut,p,xt,T,Q,W];var mt=h(ht,2);mt.__click=yt;var Lt=h(mt,2);Lt.__click=[Pt,W],O(G),b(G,e=>B=e,()=>B),It((e,o,l,a,v,K)=>{tt=z(J,"",tt,e),it=z(et,"",it,o),at=z(nt,"",at,l),ot=z(lt,"",ot,a),rt=z(st,"",rt,v),Dt(I,1,`cropper ${ft()?"circular":""}`,"svelte-10j4zly"),dt=z(I,"",dt,K)},[()=>({cursor:t(L)?"grabbing":"grab",left:`${t($)??""}px`,top:`${t(E)??""}px`,width:`${t(x)*t(y)}px`,height:`${t(M)*t(y)}px`}),()=>{var e;return{width:`${(((e=t(n))==null?void 0:e.getBoundingClientRect().width)??0)-t(g)-t(_)}px`,height:`${t(V)??""}px`}},()=>{var e;return{width:`${(((e=t(n))==null?void 0:e.getBoundingClientRect().width)??0)-t(g)-t(d)}px`,height:`${t(V)??""}px`}},()=>{var e;return{left:`${t(d)??""}px`,width:`${t(g)??""}px`,height:`${(((e=t(n))==null?void 0:e.getBoundingClientRect().height)??0)-t(C)-t(w)}px`}},()=>{var e;return{right:`${t(_)??""}px`,width:`${t(g)??""}px`,height:`${(((e=t(n))==null?void 0:e.getBoundingClientRect().height)??0)-t(C)-t(s)}px`,top:`${t(Ct)??""}px`}},()=>({width:`${t(g)??""}px`,height:`${t(C)??""}px`,top:`${t(s)??""}px`,left:`${t(d)??""}px`,cursor:t(L)?"grabbing":"grab"})]),Tt(H,()=>t(R),e=>i(R,e)),Xt(D,Z),kt()}Yt(["click"]);export{Zt as I};
